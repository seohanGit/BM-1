<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baron.member.sqlModel">
	<!--4개월간 다수 대여 팀, 도서 -->

	<select id="selectBestTeam" resultType="MemberModel">

		SELECT B.team_nm,
		COUNT(*) AS count FROM
		testlib.bookrent A INNER JOIN
		tprlib.gr_insa B
		ON A.id=B.asabn WHERE
		rentdate > current date - 12
		month GROUP BY
		B.team_nm ORDER
		BY count DESC
		<!-- 1년간 팀별 대여현황 -->
	</select>

	<select id="selectBest" resultType="MemberModel">

		SELECT (SELECT kname FROM
		tprlib.gr_insa WHERE asabn = A.asabn FETCH first 1
		rows only) AS
		kname,(SELECT team_nm FROM tprlib.gr_insa WHERE asabn =
		A.asabn FETCH
		first 1 rows only) AS team_nm, A.asabn AS id, (SELECT
		COUNT(*) FROM
		testlib.BOOKRENT B WHERE B.rentdate > current date - 12 month AND B.id
		=
		A.asabn) AS count FROM tprlib.gr_insa AS A GROUP BY
		A.asabn ORDER BY
		count DESC
	</select>

	<select id="selectBookCount" resultType="BookModel">
		SELECT COUNT(*) AS
		count, b_group FROM testlib.bookmst GROUP BY b_group
	</select>



	<select id="selectBestPerson" resultType="Dto">
		SELECT (SELECT kname
		FROM tprlib.gr_insa WHERE asabn = A.id FETCH first 1 rows only) kname
		,
		COUNT(*) AS count,
		month(A.rentdate) AS month
		FROM
		testlib.bookrent A INNER JOIN tprlib.gr_insa B
		ON A.id = B.asabn
		WHERE year(A.rentdate) = '2015'
		GROUP BY
		A.id, month(A.rentdate)
		ORDER BY
		month, count DESC
	</select>

	<select id="selectGroupByMonth" parameterType="String"
		resultType="Dto">
		SELECT COUNT(*)
		count, month(rentdate) AS month
		FROM
		testlib.bookrent
		WHERE year(rentdate) = #{year}
		GROUP BY
		month(rentdate)
	</select>

	<select id="selectBestBook" resultType="BookModel">
		SELECT COUNT(*) AS count,
		B.book_cd,
		(SELECT title FROM testlib.bookmst WHERE book_cd =
		B.book_cd) AS title,
		(SELECT author FROM testlib.bookmst WHERE book_cd
		= B.book_cd) AS
		author, (SELECT b_group FROM testlib.bookmst WHERE
		book_cd
		= B.book_cd) AS
		b_group
		FROM testlib.bookrent A INNER JOIN
		testlib.bookmst B
		ON A.book_cd
		= B.book_cd
		WHERE rentdate > current date
		- 1 year
		GROUP BY B.book_cd
		ORDER BY
		count DESC
	</select>
	<select id="selectSumPurchase" parameterType="String"
		resultType="Dto">
		SELECT SUM(DOUBLE(PRICE)) PRICE, month(rcv_date) AS month, count(rcv_date) count FROM
		testlib.bookmst WHERE year(rcv_date)=#{year}
		GROUP BY month(rcv_date)
	</select>

</mapper>
