<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baron.member.sqlModel">

	<select id="selectMemberById" resultType="int" parameterType="string">
		SELECT COUNT(*)
		FROM BOOKMEMBER
		WHERE id = #{id}
	</select>

	<insert id="insertMember" parameterType="MemberModel">
		INSERT INTO BOOKMEMBER (id,
		pass, name,email,team,cell)
		VALUES (#{id}, #{password},
		#{name},#{email},#{team},#{cell})
	</insert>
	<select id="selectPass" resultType="String" parameterType="String">
		SELECT pass
		FROM BOOKMEMBER
		WHERE id = #{id}
	</select>

	<update id="updateMember" parameterType="MemberModel">
		UPDATE BOOKMEMBER
		SET pass =
		#{password},email = #{email},address = #{address},cell =
		#{cell},home =
		#{home}
		WHERE id = #{id}
	</update>

	<select id="selectMember" resultType="MemberModel"
		parameterType="MemberModel">
		SELECT *
		FROM BOOKMEMBER
		WHERE id = #{id}
		AND pass =
		#{password}
	</select>


	<select id="selectLate" resultType="MemberModel">
		SELECT
		A.id,A.name,A.email,A.address,A.cell,A.home, B.rentdate,
		B.returndate
		FROM BOOKMEMBER as A ,BOOKRENT as B
		WHERE current date > B.returndate
		AND B.rentchk ='2' and
		A.id=B.id
	</select>

	<select id="selectBest" resultType="MemberModel">
		SELECT A.name, A.score, A.id,
		(SELECT
		COUNT(*) FROM BOOKRENT B WHERE B.rentdate >
		date_sub(current date,
		interval 30
		day) AND B.id=A.id ) AS numborrow
		FROM
		BOOKMEMBER AS A
		ORDER BY
		numborrow DESC

	</select>

	<select id="selectMemberList" resultType="MemberModel">
		SELECT *, (SELECT
		COUNT(*) FROM BOOKRENT B WHERE B.rentdate >
		date_sub(current date, interval 30
		day) AND B.id=A.id ) AS numborrow
		FROM BOOKMEMBER A
		ORDER BY team

	</select>


	<!-- 에약관련 쿼리 -->

	<insert id="insertReservation" parameterType="BookModel">
		INSERT INTO
		bookreser(id, book_cd, reser_date, reservechk)
		VALUES(#{id},
		#{book_cd}, date_add(current date, interval 7
		day), 1)
	</insert>

	<update id="updateReservation" parameterType="String">
		UPDATE BOOKMST SET
		rentchk='1', reservechk='0' WHERE book_cd=#{book_cd}
	</update>

	<select id="selectReservation" parameterType="String"
		resultType="String">
		SELECT reservechk
		FROM BOOKMST
		WHERE book_cd=#{book_cd}
	</select>

	<select id="reservationList" parameterType="String" resultType="BookModel">
		SELECT *
		FROM BOOKMST AS A, bookreser AS B
		WHERE B.book_cd=#{book_cd}
		AND
		B.id=#{id}
		ORDER BY
		B.reser_date DESC
	</select>

	<select id="reservationListAll" resultType="BookModel">
		SELECT *
		FROM BOOKMST AS
		A, bookreser AS B
		WHERE A.book_cd=B.book_cd AND
		B.reservechk='1'
		ORDER BY
		B.reser_date DESC
	</select>

	<delete id="deleteReservation" parameterType="BookModel">
		DELETE ON reserve
		WHERE id=#{id} AND book_cd=#{book_cd}
	</delete>



	<!-- 기타 쿼리 -->
	<select id="test" resultType="String">
		SELECT TITLe
		FROM BOOKMST
	</select>

</mapper>