<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baron.member.sqlModel">
	<!-- TESTLIB.BOOKMST 관련 쿼리 -->


	<select id="selectBookAll" resultType="BookModel">
		SELECT * FROM
		TESTLIB.BOOKMST A
		ORDER BY RENTCHK
	</select>

	<insert id="insertBook" parameterType="BookModel">
		INSERT INTO
		TESTLIB.BOOKMST
		(title,BOOK_CD,b_group,publish,author,rentchk,imageurl,
		rcv_date, isbn,
		price, summary)
		VALUES
		(#{title},#{book_cd},#{b_group},#{publish},#{author},0,#{imageurl},
		current date, #{isbn}, #{price}, #{summary})
	</insert>


	<select id="selectBook" parameterType="String" resultType="BookModel">
		SELECT * FROM TESTLIB.BOOKMST WHERE book_cd=#{book_cd}
	</select>

	<select id="searchBook" parameterType="String" resultType="SearchResult">
		<bind name="keyword" value="'%' + _parameter + '%'" />
		SELECT title, author, publish, b_group, rentchk, reservechk, book_cd
		FROM
		TESTLIB.BOOKMST
		WHERE
		TITLE like #{keyword}
		ORDER BY RENTCHK DESC,
		RCV_DATE DESC

	</select>

	<select id="listBook" parameterType="Dto" resultType="BookModel">
		SELECT
		title, author, b_group, rentchk, reservechk, book_cd
		FROM
		TESTLIB.BOOKMST
		ORDER
		BY RENTCHK DESC
	</select>


	<delete id="deleteBook" parameterType="String">
		DELETE FROM
		TESTLIB.BOOKMST
		WHERE
		BOOK_CD=#{book_cd}
	</delete>


	<update id="updateBook" parameterType="BookModel">
		UPDATE TESTLIB.BOOKMST
		SET
		TITLE=#{title}, b_group=#{b_group},
		publish=#{publish},
		author=#{author}
		WHERE BOOK_CD=#{book_cd}
	</update>

	<select id="getNewbook" resultType="BookModel">
		SELECT *
		FROM TESTLIB.BOOKMST
		ORDER BY
		rcv_date DESC
	</select>

	<select id="getBestSeller" resultType="BookModel">
		SELECT *
		FROM
		TESTLIB.BOOKMST
		ORDER
		BY
		sunbo DESC
	</select>

	<!-- 구매요청, 대여 관련 커리 -->

	<insert id="requestBook" parameterType="BookModel">
		INSERT INTO
		TESTLIB.BOOKREQ
		(id,reqdate,title,book_cd,price,author,quantity,b_group,link,
		imageurl,isbn, publish, summary, req_cd)
		VALUES
		(#{id}, current date,
		#{title},#{book_cd},#{price},#{author},#{quantity},#{b_group},#{link},
		#{imageurl},#{isbn}, #{publish}, #{summary}, #{req_cd})
	</insert>

	<update id="deleteRequest" parameterType="String">
		UPDATE TESTLIB.BOOKREQ
		SET
		reqstatus='2'
		WHERE book_cd=#{book_cd}
	</update>

	<select id="requestList" resultType="BookModel">
		SELECT B.title, B.imageurl, B.author, B.price, b.quantity, B.reqdate, B.reqstatus, B.id, (SELECT C.KNAME FROM
		TPRLIB.GR_INSA C WHERE B.id=C.ASABN
		FETCH
		first 1 rows only) kname
		FROM
		TESTLIB.BOOKREQ B
		WHERE reqdate <![CDATA[ > current date -1 year]]>

		ORDER BY
		reqstatus
		DESC
	</select>

	<select id="requestRecord" parameterType="String" resultType="BookModel">
		SELECT *
		FROM
		TESTLIB.BOOKREQ A

		WHERE A.id=#{id} AND
		(A.reqdate
		>
		current
		date - 1
		year
		AND <![CDATA[A.reqdate <= current
		date]]>)
		ORDER
		BY
		A.reqdate
		DESC
	</select>

	<select id="selectRequest" parameterType="String" resultType="BookModel">
		SELECT *
		FROM TESTLIB.BOOKREQ
		WHERE req_cd=#{req_cd}

	</select>

</mapper>