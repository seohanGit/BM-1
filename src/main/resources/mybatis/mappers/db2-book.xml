<?xml version="1.0" encoding="euc-kr" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baron.member.sqlModel">
	<!-- TESTLIB.BOOKMST °ü·Ã Äõ¸® -->


	<select id="selectBookAll" resultType="BookModel">
		SELECT * FROM
		TESTLIB.BOOKMST A
		ORDER BY RENTCHK
	</select>

	<insert id="insertBook" parameterType="BookModel">
		INSERT INTO
		TESTLIB.BOOKMST
		(title, book_cd,b_group, c_group, publish,author,rentchk,imageurl,
		rcv_date, isbn, price, summary, rcmdchk)
		VALUES
		(#{title},#{book_cd},#{b_group}, #{c_group}, #{publish},#{author},'0', #{imageurl},
		current date, #{isbn}, #{price}, #{summary}, '')
	</insert>


	<select id="selectBook" parameterType="String" resultType="BookModel">
		SELECT * FROM TESTLIB.BOOKMST WHERE book_cd=#{book_cd} FETCH first 1 rows only
	</select>

	<select id="searchBook" parameterType="String" resultType="SearchResult">
		<bind name="keyword" value="'%' + _parameter + '%'" />
		SELECT A.title, A.author, A.publish, A.b_group, A.rentchk,
		A.reservechk, A.book_cd, B.returndate
		FROM
		TESTLIB.BOOKMST A LEFT OUTER
		JOIN testlib.bookrent B
		ON A.book_cd = B.book_cd AND A.rentchk =
		B.rentchk
		WHERE
		LCASE(A.TITLE) like #{keyword} 
		ORDER BY A.RENTCHK DESC, A.RCV_DATE DESC 
		FETCH first 200 rows only
	</select>
	<select id="searchAuthor" parameterType="String" resultType="SearchResult">
		<bind name="keyword" value="'%' + _parameter + '%'" />
		SELECT A.title, A.author, A.publish, A.b_group, A.rentchk,
		A.reservechk, A.book_cd, B.returndate
		FROM
		TESTLIB.BOOKMST A LEFT OUTER
		JOIN testlib.bookrent B
		ON A.book_cd = B.book_cd AND A.rentchk =
		B.rentchk
		WHERE
		LCASE(A.AUTHOR) like #{keyword} 
		ORDER BY A.RENTCHK DESC, A.RCV_DATE DESC 
		FETCH first 200 rows only
	</select>
	<select id="searchPublisher" parameterType="String" resultType="SearchResult">
		<bind name="keyword" value="'%' + _parameter + '%'" />
		SELECT A.title, A.author, A.publish, A.b_group, A.rentchk,
		A.reservechk, A.book_cd, B.returndate
		FROM
		TESTLIB.BOOKMST A LEFT OUTER
		JOIN testlib.bookrent B
		ON A.book_cd = B.book_cd AND A.rentchk =
		B.rentchk
		WHERE
		LCASE(A.PUBLISH) like #{keyword}
		ORDER BY A.RENTCHK DESC, A.RCV_DATE DESC 
		FETCH first 200 rows only
	</select>

	<select id="listBook" parameterType="String" resultType="BookModel">
		SELECT
		title, author, b_group, rentchk, reservechk, book_cd, rcv_date
		FROM
		TESTLIB.BOOKMST
		ORDER
		BY rcv_date DESC
		FETCH first 200 rows only
	</select>	
	<select id="newBook" parameterType="Dto" resultType="BookModel">
		SELECT
		title, author, b_group, rentchk, reservechk, book_cd, rcv_date
		FROM
		TESTLIB.BOOKMST
		where rcv_date between #{date1} and #{date2} 
		ORDER
		BY rcv_date DESC
		FETCH first 200 rows only
	</select>
	<select id="bestBook" resultType="BookModel">
		SELECT
		title, author, b_group, rentchk, reservechk, book_cd, rcv_date
		FROM
		TESTLIB.BOOKMST
		ORDER
		BY grade DESC
		FETCH first 50 rows only
	</select>
	<select id="recommendBook" parameterType="String" resultType="BookModel">
		SELECT
		title, author, b_group, rentchk, reservechk, book_cd, rcv_date
		FROM
		TESTLIB.BOOKMST
		where rcmdchk = 'Y'
	</select>	

	<delete id="deleteBook" parameterType="String">
		DELETE FROM
		TESTLIB.BOOKMST
		WHERE
		BOOK_CD=#{book_cd}
	</delete>


	 <update id="updateBook" parameterType="BookModel">
		UPDATE TESTLIB.BOOKMST
		SET
		TITLE=#{title}, b_group=#{b_group},
		publish=#{publish},
		author=#{author},
		imageurl=#{imageurl}
		WHERE BOOK_CD=#{book_cd}
	</update>
	

	<select id="getNewbook" resultType="BookModel">
		SELECT *
		FROM TESTLIB.BOOKMST 
		WHERE rcv_date is not null
		ORDER BY
		rcv_date DESC
		FETCH first 5 rows only
	</select>


</mapper>