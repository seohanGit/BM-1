<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baron.member.sqlModel">

	<!-- 에약관련 쿼리 -->
	<!-- 예약상태 '1' = 예약 -->
	<insert id="insertReservation" parameterType="BookModel">
		INSERT INTO
		testlib.bookreser(id, book_cd, reser_date, reservechk)
		VALUES(#{id},
		#{book_cd}, (SELECT returndate FROM testlib.bookrent WHERE book_cd =
		#{book_cd} AND (rentchk='1' OR rentchk='2'))+ 2 day, 1)
	</insert>

	<insert id="insertReservation1" parameterType="String">
		UPDATE
		testlib.bookmst
		SET
		reservechk='1'
		WHERE book_cd=#{book_cd}
	</insert>

	<update id="updateReservation" parameterType="String">
		UPDATE
		testlib.bookmst SET
		rentchk='1', reservechk='0' WHERE
		book_cd=#{book_cd}
	</update>

	<delete id="deleteReserve" parameterType="String">
		DELETE FROM
		testlib.bookreser
		WHERE book_cd = #{book_cd}
	</delete>



	<select id="selectReservation" parameterType="String"
		resultType="BookModel">
		SELECT *
		FROM testlib.bookreser A INNER JOIN tprlib.gr_insa
		B
		ON A.id = B.asabn
		WHERE
		book_cd=#{book_cd}
		FETCH first 1 rows only
	</select>

	<select id="reservationList" parameterType="String" resultType="BookModel">
		SELECT A.title, A.author, A.b_group, A.reservechk, A.book_cd, (SELECT returndate FROM
		testlib.bookrent WHERE book_cd = B.book_cd AND id=#{id}) returndate
		FROM testlib.bookmst A
		INNER JOIN testlib.bookreser B
		ON
		A.book_cd = B.book_cd
		WHERE
		B.reservechk='1'
		AND
		B.id=#{id}
	</select>

	<select id="reservationListAll" resultType="BookModel">
		SELECT A.book_cd,
		B.id, B.reser_date, A.title, A.b_group, A.rentchk, (SELECT kname FROM
		tprlib.gr_insa WHERE asabn=B.id FETCH first 1 rows only) AS kname
		FROM
		testlib.bookmst A INNER
		JOIN testlib.bookreser B
		ON A.book_cd=B.book_cd
		AND
		A.reservechk=B.reservechk
		WHERE
		B.reservechk='1'
		ORDER
		BY
		B.reser_date
		DESC
	</select>


</mapper>