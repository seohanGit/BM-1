<?xml version="1.0" encoding="euc-kr" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baron.member.sqlModel">
	<!-- TESTLIB.BOOKMST 包访 孽府 -->


	<select id="selectBookAll" resultType="BookModel">
		SELECT * FROM
		TESTLIB.BOOKMST A
		ORDER BY RENTCHK
	</select>

	<insert id="insertBook" parameterType="BookModel">
		INSERT INTO
		TESTLIB.BOOKMST
		(title, book_cd,b_group,publish,author,rentchk,imageurl,
		rcv_date, isbn, price, summary)
		VALUES
		(#{title},#{book_cd},#{b_group},#{publish},#{author},'0', #{imageurl},
		current date, #{isbn}, #{price}, #{summary})
	</insert>


	<select id="selectBook" parameterType="String" resultType="BookModel">
		SELECT * FROM TESTLIB.BOOKMST WHERE book_cd=#{book_cd} FETCH first 1 rows only
	</select>

	<select id="searchBook" parameterType="String" resultType="SearchResult">
		<bind name="keyword" value="'%' + _parameter + '%'" />
		SELECT A.title, A.author, A.publish, A.b_group, A.rentchk,
		A.reservechk, A.book_cd, B.returndate
		FROM
		TESTLIB.BOOKMST A LEFT OUTER
		JOIN testlib.bookrent B
		ON A.book_cd = B.book_cd AND A.rentchk =
		B.rentchk
		WHERE
		LCASE(A.TITLE) like #{keyword} OR LCASE(A.AUTHOR) like #{keyword}
		ORDER BY A.RENTCHK DESC, A.RCV_DATE DESC 
		FETCH first 200 rows only
	</select>

	<select id="listBook" parameterType="Dto" resultType="BookModel">
		SELECT
		title, author, b_group, rentchk, reservechk, book_cd
		FROM
		TESTLIB.BOOKMST
		ORDER
		BY RENTCHK DESC
		FETCH first 100 rows only
	</select>


	<delete id="deleteBook" parameterType="String">
		DELETE FROM
		TESTLIB.BOOKMST
		WHERE
		BOOK_CD=#{book_cd}
	</delete>


	 <update id="updateBook" parameterType="BookModel">
		UPDATE TESTLIB.BOOKMST
		SET
		TITLE=#{title}, b_group=#{b_group},
		publish=#{publish},
		author=#{author},
		imageurl=#{imageurl}
		WHERE BOOK_CD=#{book_cd}
	</update>
	

	<select id="getNewbook" resultType="BookModel">
		SELECT *
		FROM TESTLIB.BOOKMST 
		WHERE rcv_date is not null
		ORDER BY
		rcv_date DESC
		FETCH first 5 rows only
	</select>


	<!-- 备概夸没, 措咯 包访 目府 -->

	<insert id="requestBook" parameterType="BookModel">
		INSERT INTO
		TESTLIB.BOOKREQ
		(id,reqdate,title,book_cd,price,author,quantity,b_group,link,
		imageurl,isbn, publish, summary, req_cd, kname)
		VALUES
		(#{id}, current
		date,
		#{title},#{book_cd},#{price},#{author},#{quantity},#{b_group},#{link},
		#{imageurl},#{isbn}, #{publish}, #{summary}, #{req_cd}, #{kname})
	</insert>

	<update id="deleteRequest" parameterType="String">
		UPDATE TESTLIB.BOOKREQ
		SET
		reqstatus='1'
		WHERE req_cd= #{req_cd}
	</update>

	<update id="rejectRequest" parameterType="String">
		UPDATE TESTLIB.BOOKREQ
		SET
		reqstatus='2'
		WHERE req_cd= #{req_cd}
	</update>

	<select id="requestList" resultType="BookModel">
		SELECT B.title, B.imageurl, B.author, B.price, b.quantity, B.reqdate,
		B.reqstatus, B.id, B.book_cd, B.req_cd, B.link, B.b_group, B.c_group,
		(SELECT C.KNAME FROM
		TPRLIB.GR_INSA C WHERE B.id=C.ASABN
		FETCH
		first 1
		rows only) kname
		FROM
		TESTLIB.BOOKREQ B
		WHERE reqdate <![CDATA[ > current date -1 year]]>

		ORDER BY
		reqstatus, reqdate DESC
	</select>

	<select id="requestRecord" parameterType="String" resultType="BookModel">
		SELECT *
		FROM
		TESTLIB.BOOKREQ A

		WHERE A.id=#{id} AND
		(A.reqdate
		>
		current
		date - 1
		year
		AND <![CDATA[A.reqdate <= current
		date]]>)
		ORDER
		BY
		A.reqdate
		DESC
	</select>

	<select id="selectRequest" parameterType="String" resultType="BookModel">
		SELECT *
		FROM TESTLIB.BOOKREQ A INNER JOIN TPRLIB.GR_INSA B
		ON
		A.id=B.ASABN
		WHERE req_cd=#{req_cd} 
		FETCH first 1 rows only

	</select>

	<update id="modifiReqBook" parameterType="BookModel">
		UPDATE TESTLIB.BOOKREQ
		SET
		book_cd = #{book_cd}

		WHERE
		req_cd = #{req_cd}
	</update>
</mapper>