<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baron.member.sqlModel">



	<select id="selectMemberById" resultType="int" parameterType="string">
		SELECT COUNT(*)
		FROM tprlib.gr_insa
		WHERE id = #{id}
	</select>

	<insert id="insertMember" parameterType="MemberModel">
		INSERT INTO
		tprlib.gr_insa
		(id,
		pass, name,email,team,cell)
		VALUES (#{id},
		#{password},
		#{name},#{email},#{team},#{cell})
	</insert>
	<select id="selectPass" resultType="String" parameterType="String">
		SELECT pass
		FROM tprlib.gr_insa
		WHERE id = #{id}
	</select>

	<update id="updateMember" parameterType="MemberModel">
		UPDATE
		tprlib.gr_insa
		SET
		pass =
		#{password},email = #{email},address =
		#{address},cell =
		#{cell},home =
		#{home}
		WHERE id = #{id}
	</update>

	<select id="selectMember" resultType="MemberModel"
		parameterType="String">
		SELECT *
		FROM TPRLIB.GR_INSA
		WHERE ASABN = #{id}
		FETCH
		first 1 rows only
	</select>


	<select id="selectLate" resultType="MemberModel">
		SELECT
		A.id,A.name,A.email,A.address,A.cell,A.home, B.rentdate,
		B.returndate
		FROM tprlib.gr_insa as A ,BOOKRENT as B
		WHERE current date >
		B.returndate
		AND B.rentchk ='2' and
		A.id=B.id
	</select>

	<select id="selectBest" resultType="MemberModel">
		SELECT A.name, A.id,
		(SELECT
		COUNT(*) FROM BOOKRENT B WHERE B.rentdate >
		current
		date -30day GROUP BY
		id) numborrow
		FROM
		tprlib.gr_insa AS A
		ORDER BY
		numborrow DESC

	</select>

	<select id="selectMemberList" resultType="MemberModel">
		SELECT *, (SELECT
		COUNT(*) FROM BOOKRENT B WHERE B.rentdate >
		date_sub(current date,
		interval 30
		day) AND B.id=A.id ) AS numborrow
		FROM tprlib.gr_insa A
		ORDER BY
		team

	</select>

	<!-- 에약관련 쿼리 -->
	<!-- 예약상태 '1' = 예약 -->
	<insert id="insertReservation" parameterType="BookModel">
		INSERT INTO
		testlib.bookreser(id, book_cd, reser_date, reservechk)
		VALUES(#{id},
		#{book_cd}, (select returndate from bookrent where
		book_cd=#{book_cd}), 1)
	</insert>

	<insert id="insertReservation1" parameterType="String">
		UPDATE
		testlib.bookmst
		SET
		reservechk='1'
		WHERE book_cd=#{book_cd}
	</insert>

	<update id="updateReservation" parameterType="String">
		UPDATE
		testlib.bookmst SET
		rentchk='1', reservechk='0' WHERE
		book_cd=#{book_cd}
	</update>



	<select id="selectReservation" parameterType="String"
		resultType="BookModel">
		SELECT *
		FROM testlib.bookreser A INNER JOIN tprlib.gr_insa
		B
		ON A.id = B.asabn
		WHERE
		book_cd=#{book_cd}
	</select>

	<select id="reservationList" parameterType="String" resultType="BookModel">
		SELECT *
		FROM testlib.bookmst A, testlib.bookreser B
		WHERE
		B.reservechk='0'
		AND
		B.id=#{id}
		ORDER BY
		B.reser_date DESC
	</select>

	<select id="reservationListAll" resultType="BookModel">
		SELECT A.book_cd,
		B.id, B.reser_date, A.title, A.b_group, A.rentchk, (SELECT kname FROM
		tprlib.gr_insa WHERE asabn=B.id FETCH first 1 rows only) AS kname
		FROM
		testlib.bookmst A INNER
		JOIN testlib.bookreser B
		ON A.book_cd=B.book_cd
		AND
		A.reservechk=B.reservechk
		WHERE
		B.reservechk='1'
		ORDER
		BY
		B.reser_date
		DESC
	</select>

	<!-- 기타 쿼리 -->



</mapper>